# ユーザー管理機能

## 全体概要

### 概要

テナントに所属するユーザーの権限設定、削除、復元を行う機能群。システム管理者が中心となり、ユーザー権限の割り当てや管理を効率的に実施できる。

### ビジネス目標

* テナントに所属するユーザーの権限を適切に管理し、セキュリティを確保する
* 不要になったユーザーを安全に削除し、必要に応じて復元できるようにする
* システム管理者とメンバーの役割を明確に分離し、誤操作や不正操作を防止する

### 全体受け入れ条件

* テナントに所属するユーザーを一覧表示し、権限を適切に管理できる
* 削除済みユーザーを安全に復元できる
* テナントには常に少なくとも1人のシステム管理者が存在する

---

## テナントにおけるユーザー権限

システム管理者 > メンバー > ゲスト の階層関係を持つ。

* システム管理者

  * 契約・請求、テナント設定、ユーザー管理が可能
  * メンバー権限をすべて含む
  * 管理者・メンバー・ゲストの追加、ロール変更、削除・復元が可能
  * 最後の管理者を削除・降格することは不可

* メンバー

  * 日常業務に必要な操作（編集、AI利用、現場の作成・管理など）が可能
  * ゲストの招待・削除・復元が可能
  * 管理者およびメンバーの追加・ロール変更・削除は不可
  * 管理者関連の設定変更は不可

* ゲスト

  * 閲覧とコメントのみ可能
  * 編集、設定、契約関連操作は不可
  * 招待上限は固定（100人）で契約数には含まれない

---

## テナントユーザー管理機能

### ステータス

* [x] 検討中
* [x] 概念設計中
* [ ] 概念設計確定
* [ ] 実装中
* [ ] 実装完了
* [ ] 不採用

### 機能概要

テナントに所属するユーザー（管理者・メンバー・ゲスト）の一覧表示、権限変更、削除、復元を行う。権限境界はロールに応じて制御される。

### ビジネス目標

* システム管理者による一元的なユーザー管理を実現し、組織内のアクセス制御を効率化する
* 権限ごとの操作範囲を明確化し、不正や誤操作によるリスクを減らす

### 機能要件（ユーザーストーリー形式）

* ユーザー一覧表示

  * システム管理者は、全ユーザー（管理者・メンバー・ゲスト・削除済み）の一覧を閲覧できる
  * メンバーは、テナントに所属するユーザー一覧を閲覧できる（管理者の有無を含む）
  * ゲストは、自身に関連する範囲のユーザーのみを閲覧できる

* ユーザー情報変更

  * システム管理者は、全ユーザーのロールを変更できる（最終管理者の降格は不可）
  * メンバーは、ゲストのプロフィール情報を変更できるが、ロール変更は不可
  * ゲストは、自身の表示名や通知設定のみ変更できる

* 招待・追加

  * システム管理者は、管理者・メンバー・ゲストを招待・追加できる
  * メンバーは、ゲストのみ招待・追加できる（メンバーの招待は不可）

* ユーザー削除・復元

  * システム管理者は、任意のユーザーを削除・復元できる（最終管理者は削除不可）
  * メンバーは、ゲストを削除・復元できる
  * 削除はテナントとの関係を解消する操作であり、ユーザーアカウント自体はシステムに残る
  * 削除済みユーザーは「削除済み」ステータスで一覧表示され、復元可能


## 備考

* テナントには必ず1人以上のシステム管理者が存在する必要がある
* 最後のシステム管理者は削除・降格できない
* 招待フローやユーザー数制御との連携は、別設計書（ユーザー数制御機能）に準拠する
