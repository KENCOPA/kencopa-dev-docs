---
type: note
moc: "[[🏷️概念設計書]]"
---


# アクティビティ詳細機能（工程表エディター）

## 全体概要

### 概要

工程表エディター上の各アクティビティ（線）をダブルクリックすると右ペインが開き、当該アクティビティの詳細情報を確認・編集できる機能。
基本情報（名称・期間等）に加え、日数計算や工種体系マスターの紐付けなど、工程管理に必要な設定を一元的に行える。

### ビジネス目標

* 現場監督がアクティビティ単位で必要な情報を迷わず入力できるUIを提供し、認知負荷を軽減する。
* 工程表作成の時間を短縮し、修正や調整を効率化する。
* 工種体系マスターとの連動により、技術継承や組織知の資産化を促進する。
* 人力調整（調整日数）の余地を残し、実務的な柔軟性を確保する。

### 全体受け入れ条件
ユーザーはアクティビティをダブルクリックして詳細ペインを開閉できる。
ユーザーは基本情報でアクティビティ名と期間を編集できる。
ユーザーは日数計算で算出日数と調整日数を操作し、合計日数を決定できる。
システムは「工程表に反映」で合計日数を工程表上の期間（日付）に反映できる。
システムはガント上の手動編集と日数計算タブの整合を保ち、二重加算や不整合が発生しない。

---


## アクティビティ詳細ペイン（コンテナ）

### ステータス

* [ ] 検討中
* [x] 概念設計中
* [ ] 概念設計確定
* [ ] 実装中
* [ ] 実装完了
* [ ] 不採用

### 機能概要

工程表のアクティビティ（線）をダブルクリックすると、画面右側に「アクティビティ詳細ペイン」を開き、当該アクティビティの詳細をタブ形式で閲覧・編集できる。
初期タブは「基本情報」「日数計算」。
将来的なタブ追加（例：依存関係、添付、コスト、リソース、履歴、コメント等）を前提に拡張可能なコンテナとして設計する。
ペインはワンクリック/ショートカットで素早く開閉でき、編集結果はエディターに即時反映される。

### ビジネス目標

* メイン画面から離れずに編集できる動線で認知負荷・操作往復を削減
* 最小手数で「見る→直す→確定」を完結し、工程表作成・更新速度を向上
* 標準化された入力器（タブ群）でデータ品質と将来拡張（新タブ追加）を確保

### 機能要件（ユーザーストーリー形式）

* ユーザーはアクティビティをダブルクリックして詳細ペインを開ける。
* ユーザーはEscキー、右上「×」、または外側クリック（設定可能）でペインを閉じられる。
* ユーザーは選択中のアクティビティをEnter（または⌘/Ctrl+Enter）で開ける。

---

## 基本情報タブ

### ステータス

* [ ] 検討中
* [x] 概念設計中
* [ ] 概念設計確定
* [ ] 実装中
* [ ] 実装完了
* [ ] 不採用

### 機能概要

アクティビティの名称や期間を日付ベースで管理するタブ。
開始日・終了日は工程全体の制約に直結するため、どちらを固定するかをユーザーが選択できる。

### ビジネス目標

* ユーザーが直感的にアクティビティの期間を編集できるようにする。
* 「開始日固定」「終了日固定」を選択可能にして、日数計算や調整処理との一貫性を確保する。
* 期間調整の自由度を残しつつ、現場での工期制約（引渡日など）に対応できる。

### 機能要件

* ユーザーはアクティビティ名を編集できる。
* ユーザーは開始日と終了日を確認できる。
* ユーザーは「開始日固定／終了日固定」を選択できる（デフォルト：開始日固定）。
* ユーザーが「開始日固定」を選択した場合、開始日は編集不可、終了日のみ編集可能。
* ユーザーが「終了日固定」を選択した場合、終了日は編集不可、開始日のみ編集可能。


---

## 日数計算タブ

### ステータス
* [ ] 検討中
* [x] 概念設計中
* [ ] 概念設計確定
* [ ] 実装中
* [ ] 実装完了
* [ ] 不採用

### 機能概要

アクティビティの期間を**「算出日数（理論値）」＋「調整日数（バッファ）」**で決定するタブ。
算出日数は工種体系マスターを用いた計算で求める。調整日数はユーザー入力で±可能。
最終的な**合計日数 = 算出日数 + 調整日数**を工程表に反映する。
算出日数は「再計算→反映」で更新可能。反映時には調整日数を**自動的にリセット／調整**し、合計値が自然に維持される。

---

### ビジネス目標

* マスターにもとづく**標準化された日数**を提示し、再現性と説明可能性を担保する。
* 同時に現場監督が**現場事情を加味できる柔軟性**を提供する。
* 「算出値は目安、調整は裁量、最終は合計」という役割分担でユーザーの混乱を避ける。
* ガント編集（手動操作）と整合性がとれ、二重加算や不整合を防ぐ。

---

### 機能要件（ユーザーストーリー形式）

#### A. 日数設定

* ユーザーは算出日数（システム計算値）を確認できる。
* ユーザーは調整日数（±整数）を入力できる。
* システムは合計日数 = 算出日数 + 調整日数 を即時計算して表示する。
* ユーザーが算出日数を再計算・反映した場合、システムは調整日数を自動調整し、合計日数が不自然に増減しないようにする（例：差分リセットまたは差分最小化）。

#### B. 計算方式の選択

* ユーザーは「日数計算」または「歩掛計算」を選択できる。
* **日数計算**：

  * マスターが「基準量（例：5t）と基準日数（例：2日）」を保持する。
  * 入力：総作業量（例：10t）。
  * 計算式：`算出日数 = ceil( (作業量 ÷ 基準量) × 基準日数 )`。
  * 例：10t ÷ 5t × 2日 = 4日。
* **歩掛計算**：

  * マスターが「基準量（例：5t）と必要人日（例：3人日）」を保持する。
  * 入力：総作業量（例：10t）、投入人数（例：3人）。
  * 計算式：

    * `総必要人日 = (作業量 ÷ 基準量) × 必要人日`
    * `算出日数 = ceil( 総必要人日 ÷ 投入人数 )`
  * 例：10t ÷ 5t × 3人日 = 6人日 → 6 ÷ 3人 = 2日。

#### C. 工程表への反映

* ユーザーは「算出日数に反映」で上段の算出日数を更新できる。
* ユーザーは「工程表に反映」でガントに確定できる。
* 工程表反映時は、基本情報タブの「固定方式（開始／終了）」に従って日付が調整される。

#### D. エディター操作との同期

* ユーザーがガント上で期間を直接変更した場合、システムは**算出日数は保持し、調整日数で差分を吸収**する。
* 例：算出10日＋調整0日＝合計10日 → ガント上で12日に延長 → 算出10日＋調整+2日＝合計12日。

#### E. バリデーションと警告

* 合計日数が1日未満になった場合はエラーを表示し、最小1日に修正する。

---


---

## アクティビティの調整日
### ステータス
- [X] 検討中（PdMが要件を整理している段階）
- [ ] 概念設計中（PdMが概念設計を行っている段階）
- [ ] 概念設計確定（PdMが概念設計を固め、エンジニアに渡せる状態）
- [ ] 実装中（Engが開発中）
- [ ] 実装完了（機能がリリース済み）
- [ ] 不採用（検討の結果ボツになったもの）

### 機能概要
アクティビティに「実働日」と「調整日（予備日）」を設定できるようにする。
調整日は天候や不確実要素を吸収するためのバッファとして活用され、工程表エディター上で区別して表示される。

### ビジネス目標
工程計画の現実性を高め、予期せぬ遅延に対応できるようにする。

実動と予備を分けて表現することで、関係者間での認識齟齬を防ぐ。


### 機能要件
#### ユーザーは、アクティビティに実働日と調整日を設定できる。

#### ユーザーは、アクティビティの調整日をエディター上で区別して表示できる。

#### ユーザーは、調整日の表示をオン／オフできる。


---