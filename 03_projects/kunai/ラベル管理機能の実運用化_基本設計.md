---
type: note
moc: "[[🏷️基本設計書]]"
---
## 目的
業務データそのものではなく「表示名（ラベル）」の柔軟性を担保することを目的としている。

つまり、システム内のエンティティ名、項目名、UI上のラベルなどを、テナントごとに任意の表示名へカスタマイズ可能にする仕組みが必要である。例えば、システム標準では「工事現場」と表示されるラベルを、自社の業務用語に合わせて「プロジェクト」へ置き換えることができる。

# 🏗 システム構成概要
	- フロントエンド
		- ラベルデータをAPIから取得し、アプリケーション全体で共有する仕組みを持つ。
		- 各UIコンポーネントはハードコードされた文字列ではなく、この共有データからラベルを参照する。
		- ラベル更新後は、キャッシュを無効化し、最新のラベルを再取得してUIに反映させる仕組みを持つ。（例: react-query の queryClient.invalidateQueries）
	- バックエンド
		- テナントごとにカスタマイズされたラベル設定を保持する。
		- ラベル設定を読み書きするためのAPIエンドポイントを提供する(getLabelsByTenant.ts)
	- データベース
		- テナントIDと紐づけて、システム標準のラベルとカスタマイズされたラベルの対応関係を保存する。

# 🛠 基本設計

## モジュール構成

- 各パッケージ／クラスの責務
- ディレクトリ構成例

```text
src/
├─ api/
├─ service/
├─ model/
└─ utils/
```

## データモデル
label_customizationsテーブルが関連。
名称のカスタマイズにすでに対応されている。

## API 仕様
説明: 現在のテナントに設定されているすべてのカスタムラベルと、設定されていない場合はシステム標準ラベルをマージして返す。
| エンドポイント | メソッド | リクエスト例 | レスポンス例                  |
| -------------- | -------- | ------------ | ----------------------------- |
| /v1/protected/tenant-context/labels     | GET      | {"customValue": "案件"} | {"id": "_", "labelKey": "project","customValue": "案件", "isCustomized": true}|

# 🔧 非機能要件対応

- **性能要件**→ ラベルデータはログイン時に一度取得し、更新がない限りフロントエンドでキャッシュすることで頻繁なAPI呼び出しは避ける。レイテンシ 200ms 以下
- **可用性**:
	- ユーザー設定のラベルデータの取得に失敗した場合でも、システム標準のラベルをフォールバックとして表示することで、UIの表示を維持する。
- **セキュリティ**→ バックエンドでの認可処理が既存

# 実装方針
UI反映
1. ラベル設定画面で保存ボタンが押されたら呼び出されるフックを作成。このフックがPUTリクエストを送信
2. 作成したフックの onSuccess コールバック内で、react-query の queryClient.invalidateQueries を実行し、ラベル取得API (GET /v1/protected/tenant-context/labels) のキャッシュを無効化する。
3. キャッシュが無効化されると、useGetLabelsQuery を使用している箇所が自動的にデータを再取得する。グローバルな状態が更新され、Label コンポーネントや useLabel フックを使用しているすべてのUIが新しい表示名で再レンダリングされる。
