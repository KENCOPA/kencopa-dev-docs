---
type: note
moc: "[[🏷️ADR]]"
tags:
- '#ai/ref'
---
> [!info] 必要なセクションを選択して使用してください！

# 📜 文脈・背景

現在、書類削除ロジックを実装するにあたり、以下の課題が浮上している。

1. **書類量の多さ**
    
    工事現場やプロジェクトに紐づく書類が膨大であるため、誤って削除すると重大な業務障害を招く恐れがある。
    
2. **重要書類の扱い**
    
    作業指示書やKY（危険予知）は事故発生時に必ず参照する必要があるため、安易な削除は許容できない。
    
3. **復旧依頼の増加**
    
    誤削除による復旧依頼が大量に発生すると、サポート負荷とコストが大幅に増大する。
    

これらを踏まえ、削除対象の分類基準や論理削除の導入など、慎重かつ確実な運用方針を早急に策定する必要がある。

# 🎨 対応案

## 対応案1：全て物理削除
最も素直な実装。しかし、重要な書類が消えてしまう上、復旧の手順が面倒になる。
## 対応案2：全て論理削除
全てを論理削除とすることで復旧が容易になる。一方でemailaddressやname（ラベルなど）をPK / UKとしているリソースは削除後の再作成ができなくなってしまうため不便。
## 対応案3：基本的に論理削除、一部物理削除
対応案1と3のハイブリッドアプローチ。基本的には論理削除としつつ、再作成時に不都合が生じるリソースは物理削除とする。

# 🚀 決定

復旧の容易さ、アプリケーションとしての挙動を考慮し、「対応案3：基本的に論理削除、一部物理削除」を採用する。

# 🪞 結果・影響

## プラスの結果
- 誤削除の 場合でも簡単に復旧できる
- リソースの再作成時も問題なく動作する
## マイナスの結果
- DBスキーマを変更する必要がある
- get, putのロジックも修正する必要がある

> [!caution] 実装漏れがないようにレビューでしっかり確認。

